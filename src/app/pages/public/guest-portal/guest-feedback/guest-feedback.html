<!-- Standalone wrapper (only when opened by route /guest/feedback/:eventId) -->
<div *ngIf="standalone(); else inlineBlock"
     class="min-h-[70vh] flex items-start justify-center bg-gray-50 dark:bg-[#0a0a0a] px-6 py-10">
  <div class="max-w-2xl w-full bg-white/70 dark:bg-[#111]/80 border border-gray-200 dark:border-gray-700 rounded-2xl shadow-xl p-6">
    <ng-container *ngTemplateOutlet="content"></ng-container>
  </div>
</div>

<!-- Inline block (embed inside invite card) -->
<ng-template #inlineBlock>
  <div class="mt-8">
    <ng-container *ngTemplateOutlet="content"></ng-container>
  </div>
</ng-template>

<!-- Shared content -->
<ng-template #content>
  <!-- error -->
  <div *ngIf="error()" class="text-sm text-red-600 dark:text-red-400 border border-red-300/40 rounded-md p-3">
    {{ error() }}
  </div>

  <ng-container *ngIf="!error()">
    <div class="mb-3">
      <div class="text-sm font-bold text-orange-500">Rate this event</div>
      <div class="text-xs text-zinc-500" *ngIf="event()">
        {{ event()?.name }} • {{ event()?.startDate }} → {{ event()?.endDate }}
      </div>
    </div>

    <!-- If can rate -->
    <div *ngIf="canLeave(); else locked" class="space-y-4">
      <!-- Stars -->
      <div class="flex items-center gap-2 select-none">
        <button
          type="button"
          class="leading-none"
          *ngFor="let s of [1,2,3,4,5]"
          (click)="setStars(s)"
          (mouseenter)="enter(s)"
          (mouseleave)="leave()"
          [attr.aria-label]="'Rate ' + s + ' star'">

          <svg viewBox="0 0 24 24" class="w-9 h-9">
            <defs>
              <linearGradient [attr.id]="gradId" x1="0" x2="1">
                <stop offset="0%"  stop-color="#f97316"></stop>
                <stop offset="100%" stop-color="#fb923c"></stop>
              </linearGradient>
            </defs>

            <path
              [attr.fill]="(hover() || rating()) >= s ? 'url(#' + gradId + ')' : 'none'"
              [attr.stroke]="(hover() || rating()) >= s ? 'url(#' + gradId + ')' : '#a1a1aa'"
              stroke-width="1.6"
              d="M12 17.27l5.18 3.02-1.64-5.81 4.46-3.87-5.9-.51L12 4 9.9 10.1l-5.9.51 4.46 3.87-1.64 5.81L12 17.27z" />
          </svg>
        </button>
      </div>

      <!-- Optional comment -->
      <div>
        <label class="block text-xs text-zinc-500 mb-1">Optional comment</label>
        <textarea
          class="w-full rounded-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-[#0f0f0f] px-3 py-2 text-sm text-gray-800 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-orange-500/40"
          rows="3"
          [ngModel]="comment()"
          (ngModelChange)="comment.set($event)"
          placeholder="Share anything specific (optional)…"></textarea>
      </div>

      <!-- Save -->
      <button
        class="relative inline-block text-sm font-semibold uppercase border-2 border-orange-500 text-orange-500 px-5 py-2 rounded-md overflow-hidden transition-all duration-500 group disabled:opacity-50 disabled:cursor-not-allowed"
        [disabled]="rating() < 1"
        (click)="save()">
        <span
          class="absolute inset-0 bg-orange-500 -translate-x-full translate-y-full group-hover:translate-x-0 group-hover:translate-y-0 transition-transform duration-700 ease-out"></span>
        <span class="relative z-10 group-hover:text-white transition duration-300">
          Save Rating
        </span>
      </button>

      <div *ngIf="saved()" class="text-green-700 dark:text-green-300 text-sm">
        Thanks! Your rating was saved.
      </div>
    </div>

    <!-- Locked -->
    <ng-template #locked>
      <div class="text-sm text-gray-600 dark:text-gray-400 border border-dashed border-gray-300 dark:border-gray-700 rounded-md p-3">
        Feedback will be available <strong>after the event ends</strong> and only if you
        <strong>accepted/registered</strong>.
      </div>
    </ng-template>
  </ng-container>
</ng-template>
