<nav
  class="fixed top-0 left-0 w-full z-50 bg-white dark:bg-[#0a0a0a] backdrop-blur-md border-b border-gray-200 dark:border-gray-800 transition-colors duration-500"
>
  <div class="max-w-7xl mx-auto px-6 py-3 flex items-center justify-between">
    <!-- Logo -->
    <a
      routerLink="/"
      class="grid grid-flow-col grid-rows-2 gap-0 items-center text-center space-x-1 uppercase font-bold text-black dark:text-white tracking-tight"
    >
      <span>Co<span class="text-orange-500">nn</span>ect</span>
      <span class="dark:text-white text-black">Sphere</span>
    </a>

    <!-- Desktop Menu -->
    <ul
      class="hidden md:flex items-center space-x-10 text-sm font-semibold text-zinc-700 dark:text-zinc-200 uppercase"
    >
      <a routerLink="/" class="hover:text-orange-500 dark:hover:text-white cursor-pointer transition">Home</a>
      <a routerLink="/events" class="hover:text-orange-500 dark:hover:text-white cursor-pointer transition">Events</a>
      <a routerLink="/about" class="hover:text-orange-500 dark:hover:text-white cursor-pointer transition">About</a>
      <a routerLink="/contact" class="hover:text-orange-500 dark:hover:text-white cursor-pointer transition">Contact Us</a>
    </ul>

    <!-- Right Controls -->
    <div class="flex items-center space-x-4">
      <!-- When NOT logged in: Login / Register -->
      @if (!user()) {
        <div class="hidden md:flex items-center gap-2">
          <button
            (click)="goLogin()"
            class="relative hidden md:block text-sm font-semibold uppercase border border-zinc-500 border-opacity-50 hover:border-orange-500 dark:hover:border-orange-400 text-black dark:text-white px-5 py-2 rounded-md overflow-hidden transition-all duration-500 group"
          >
            <span class="absolute inset-0 bg-orange-500 dark:bg-orange-400 translate-x-[-100%] translate-y-[100%] group-hover:translate-x-0 group-hover:translate-y-0 transition-transform duration-700 ease-out rounded-md"></span>
            <span class="relative z-10 group-hover:text-white dark:group-hover:text-black transition duration-300">Login</span>
          </button>
          <button
            (click)="goRegister()"
            class="relative hidden md:block text-sm font-semibold uppercase border border-zinc-500 border-opacity-50 hover:border-orange-500 dark:hover:border-orange-400 text-black dark:text-white px-5 py-2 rounded-md overflow-hidden transition-all duration-500 group"
          >
            <span class="absolute inset-0 bg-orange-500 dark:bg-orange-400 translate-x-[-100%] translate-y-[100%] group-hover:translate-x-0 group-hover:translate-y-0 transition-transform duration-700 ease-out rounded-md"></span>
            <span class="relative z-10 group-hover:text-white dark:group-hover:text-black transition duration-300">Register</span>
          </button>
        </div>
      } @else {
        <!-- Logged in: avatar + dropdown -->
        <div class="relative hidden md:block">
          <button
            id="profile-btn"
            (click)="toggleProfile(); $event.stopPropagation()"
            class="relative flex items-center gap-2 px-2 py-1 rounded-md hover:bg-zinc-100 dark:hover:bg-zinc-800 transition"
            title="Account"
          >
            <div class="w-8 h-8 rounded-full bg-gradient-to-br from-orange-500 to-pink-500 text-white grid place-items-center font-bold">
              {{ initials(user()?.name, user()?.email) }}
            </div>

            <!-- ðŸ”” Pending invite badge (only if > 0) -->
            @if (pendingInvites() > 0) {
              <span
                class="absolute -top-1 -right-1 min-w-5 h-5 px-1 rounded-full bg-red-600 text-white text-[10px] font-bold grid place-items-center shadow"
                [attr.aria-label]="'Pending invitations: ' + pendingInvites()"
              >
                {{ pendingInvites() }}
              </span>
            }

            <svg class="w-4 h-4 text-zinc-600 dark:text-zinc-300" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 011.08 1.04l-4.25 4.25a.75.75 0 01-1.08 0L5.21 8.27a.75.75 0 01.02-1.06z" clip-rule="evenodd"/>
            </svg>
          </button>

          @if (profileOpen) {
            <div
              id="profile-menu"
              (click)="$event.stopPropagation()"
              class="absolute right-0 mt-2 w-56 rounded-md border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 shadow-lg overflow-hidden"
            >
              <div class="px-4 py-2 text-xs text-zinc-500 border-b border-zinc-100 dark:border-zinc-800">
                @if (pendingInvites() > 0) {
                  <span>Pending invites: <strong class="text-red-600">{{ pendingInvites() }}</strong></span>
                } @else {
                  <span>No pending invites</span>
                }
              </div>
              <a routerLink="/profile" (click)="closeProfile()"
                 class="block px-4 py-2 text-sm hover:bg-zinc-100 dark:hover:bg-zinc-800">
                Profile
              </a>
              @if (user()?.role === 'admin' || user()?.role === 'organizer') {
                <a routerLink="/dashboard" (click)="closeProfile()"
                   class="block px-4 py-2 text-sm hover:bg-zinc-100 dark:hover:bg-zinc-800">
                  Dashboard
                </a>
              }
              <button (click)="logout()"
                class="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-950/40">
                Logout
              </button>
            </div>
          }
        </div>
      }

      <!-- Theme toggle -->
      <button
        (click)="theme.toggle()"
        class="text-zinc-700 dark:text-zinc-200 cursor-pointer hover:scale-100 transition"
        title="Toggle theme"
      >
        @if (themeSignal() === 'light') {
          <svg xmlns="http://www.w3.org/2000/svg" fill="none"
            viewBox="0 0 24 24" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M12 3v1m0 16v1m8.66-8.66h1M4.34 12H3m15.36 6.36l.7.7M6.34 6.34l-.7-.7m12.02 0l.7-.7M6.34 17.66l-.7.7M12 8a4 4 0 100 8 4 4 0 000-8z" />
          </svg>
        } @else {
          <svg xmlns="http://www.w3.org/2000/svg" fill="none"
            viewBox="0 0 24 24" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M21 12.79A9 9 0 1111.21 3a7 7 0 009.79 9.79z" />
          </svg>
        }
      </button>

      <!-- Mobile Menu Button -->
      <button (click)="toggleMenu()" class="md:hidden hover:cursor-pointer text-black dark:text-white focus:outline-none">
        @if (!menuOpen) {
          <svg xmlns="http://www.w3.org/2000/svg" fill="none"
            viewBox="0 0 24 24" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        } @else {
          <svg xmlns="http://www.w3.org/2000/svg" fill="none"
            viewBox="0 0 24 24" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M6 18L18 6M6 6l12 12" />
          </svg>
        }
      </button>
    </div>
  </div>

  <!-- Mobile Menu -->
  @if (menuOpen) {
    <div class="md:hidden bg-white dark:bg-[#0a0a0a] border-t border-zinc-200 dark:border-black px-6 py-4">
      <ul class="flex flex-col space-y-4 text-zinc-700 dark:text-zinc-200 uppercase text-sm font-semibold">
        <a routerLink="/" class="hover:text-orange-500 dark:hover:text-white cursor-pointer transition">Home</a>
        <a routerLink="/events" class="hover:text-orange-500 dark:hover:text-white cursor-pointer transition">Events</a>
        <a routerLink="/about" class="hover:text-orange-500 dark:hover:text-white cursor-pointer transition">About</a>
        <a routerLink="/contact" class="hover:text-orange-500 dark:hover:text-white cursor-pointer transition">Contact Us</a>

        @if (!user()) {
          <div class="pt-2 flex gap-2">
            <button (click)="goLogin()"
              class="flex-1 border border-zinc-500 text-black dark:text-white px-5 py-2 rounded-md hover:bg-orange-500 dark:hover:bg-orange-400 hover:text-white dark:hover:text-black transition">
              Login
            </button>
            <button (click)="goRegister()"
              class="flex-1 bg-orange-500 dark:bg-orange-400 text-white dark:text-black px-5 py-2 rounded-md hover:opacity-90 transition">
              Register
            </button>
          </div>
        } @else {
          <div class="pt-2 space-y-2">
            <div class="flex items-center gap-3">
              <div class="w-9 h-9 rounded-full bg-gradient-to-br from-orange-500 to-pink-500 text-white grid place-items-center font-bold">
                {{ initials(user()?.name, user()?.email) }}
              </div>
              <div class="text-xs truncate max-w-[200px]">{{ user()?.email }}</div>

              <!-- Mobile badge -->
              @if (pendingInvites() > 0) {
                <span class="ml-auto px-2 py-0.5 rounded-full bg-red-600 text-white text-[10px] font-bold">
                  {{ pendingInvites() }}
                </span>
              }
            </div>
            <a routerLink="/profile" (click)="toggleMenu()" class="block px-2 py-2 rounded hover:bg-zinc-100 dark:hover:bg-zinc-800">Profile</a>
            @if (user()?.role === 'admin' || user()?.role === 'organizer') {
              <a routerLink="/dashboard" (click)="toggleMenu()" class="block px-2 py-2 rounded hover:bg-zinc-100 dark:hover:bg-zinc-800">Dashboard</a>
            }
            <button (click)="logout()" class="w-full text-left px-2 py-2 rounded text-red-600 hover:bg-red-50 dark:hover:bg-red-950/40">Logout</button>
          </div>
        }

        <button class="border border-zinc-500 text-black dark:text-white px-5 py-2 rounded-md hover:bg-orange-500 dark:hover:bg-orange-400 hover:text-white dark:hover:text-black transition duration-300">
          Save My Spot
        </button>
      </ul>
    </div>
  }
</nav>
