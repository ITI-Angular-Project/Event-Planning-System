@if (mobileOpen) {
<div class="fixed inset-0 bg-black/40 z-40 md:hidden" (click)="closeMobile()"></div>
}
<aside
  id="app-sidebar"
  class="bg-gradient-to-b from-purple-900 to-indigo-900 dark:from-purple-900/5 dark:to-indigo-900/5 text-white hidden md:flex md:flex-col shadow-2xl transform transition-all duration-500 ease-in-out md:fixed md:h-screen"
  [class.w-64]="!isCollapsed()"
  [class.w-20]="isCollapsed()"
  [class.block]="mobileOpen"
  [class.fixed]="mobileOpen"
  [class.inset-0]="mobileOpen"
  [class.z-50]="mobileOpen"
  [class.hidden]="!mobileOpen"
>
  <div
    class="p-6 flex items-center justify-between border-b border-purple-700/50 dark:border-purple-300/20"
  >
    <div class="transition-all duration-300 flex items-center gap-3" [class.hidden]="isCollapsed()">
      <div
        class="w-10 h-10 bg-gradient-to-br from-purple-400 to-pink-400 rounded-lg flex items-center justify-center shadow-lg"
      >
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
          ></path>
        </svg>
      </div>
      <div>
        <h1 class="text-xl font-bold">EventPlan</h1>
        <p class="text-xs text-purple-300">Pro</p>
      </div>
    </div>

    <button
      class="p-2 hover:bg-purple-800 rounded-lg transition-colors duration-200"
      (click)="toggle.emit()"
      [class.mx-auto]="isCollapsed()"
      aria-label="Toggle collapse"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          [attr.d]="isCollapsed() ? 'M13 5l7 7-7 7M5 5l7 7-7 7' : 'M11 19l-7-7 7-7m8 14l-7-7 7-7'"
        ></path>
      </svg>
    </button>
  </div>

  <nav class="flex-1 px-4 py-6">
    <ul class="space-y-2">
      @for (item of menuItems; track item.route) {
      @if (item.roles && item.roles.indexOf(loggedInUser.role) === -1) {
        <!-- skip items not allowed for the current role -->
      } @else {
      <li>
        <a
          class="flex items-center gap-4 px-4 py-3 rounded-lg hover:bg-purple-800 transition-all duration-200 group relative"
          [routerLink]="item.route"
          routerLinkActive="bg-purple-700 shadow-lg"
          [routerLinkActiveOptions]="{ exact: true }"
          [class]="isCollapsed() ? 'justify-center' : ''"
        >
          <svg class="w-6 h-6 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              [attr.d]="item.icon"
            ></path>
          </svg>

          <span
            class="font-medium transition-all duration-300"
            [class]="isCollapsed() ? 'hidden' : 'block'"
          >
            {{ item.label }}
          </span>

          @if (item.badge && !isCollapsed()) {
          <span class="ml-auto bg-pink-500 text-white text-xs font-bold px-2 py-1 rounded-full">
            {{ item.badge }}
          </span>
          } @if (item.badge && isCollapsed()) {
          <span
            class="absolute -top-1 -right-1 bg-pink-500 text-white text-xs font-bold w-5 h-5 rounded-full flex items-center justify-center"
          >
            {{ item.badge }}
          </span>
          } @if (isCollapsed()) {
          <div
            class="absolute left-full ml-2 px-3 py-2 bg-gray-900 text-white text-sm rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap shadow-xl z-50"
          >
            {{ item.label }}
            <div
              class="absolute right-full top-1/2 -translate-y-1/2 border-4 border-transparent border-r-gray-900"
            ></div>
          </div>
          }
        </a>
      </li>
      }
      }
    </ul>
  </nav>

  <div class="p-4 border-t border-purple-700/50 dark:border-purple-300/20">
    <div
      class="flex justify-center items-center gap-3 p-3 hover:bg-purple-800 rounded-lg transition-colors duration-200 cursor-default"
    >
      <div
        class="w-10 h-10 bg-gradient-to-br from-pink-400 to-purple-400 rounded-full flex items-center justify-center font-bold flex-shrink-0"
      >
        OG
      </div>
      <div class="flex-1 min-w-0" [class]="isCollapsed() ? 'hidden' : 'block'">
        <p class="font-medium truncate">{{ loggedInUser.name }}</p>
        <p class="text-xs text-purple-300 truncate">{{ loggedInUser.email }}</p>
      </div>
    </div>
  </div>
</aside>
